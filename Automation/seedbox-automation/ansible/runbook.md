# B. Seedbox Automation - DSA deployment 

## Service Overview

This is runbook for Seedbox automation. Seedbox automation script is responsible for deploying DSC core packages, DSC dependent packages, KVM packages and some disk related configuration. 
DSA ansible script has different playbooks for deploying packages on production, QA and database VM.

## Technical overview

Seedbox automation has 2 playbooks files and 2 bash script(run.sh and Seedbox_Verfication_TestCases.sh)  
**1. dsa_setup.yml**  
This is playbook for deploying KVM, creating Partition and installing DSA components. Playbook will run ansible test cases after every role execution for verifying deployment of dsa components.

**2. dsa_setup_on_dbvm.yml**  
This is playbook for installing DSA components on database VM. Playbook will run ansible test cases after every role execution for verifying deployment of dsa components.

**3. run.sh**  
This is ansible playbook caller bash script. Basically run.sh script will read host details from the inventory files which will be generated by stacki. Script will get environment and the action to be taken from jenkins job. Based on received inputs from jenkins, run.sh script will call the corresponding playbook file.

**4. Seedbox_Verfication_TestCases.sh**  
This is verification test cases file. This file has different      test cases for verifying the functionality of viewpoint ui, bynet interfaces and firewall.  
This file will take 3 cli args as input.  
example: **bash Seedbox_Verfication_TestCases.sh SEEDBOX_IP BYNET0_IP BYNET1_IP**

## Required resources for Seedbox automation system  
Following are the required infrastructure details where Seedbox automation software will be deployed.
1. Jenkins server
2. Stacki Frontend
3. Apache repository server

## Required resources for DSA system (Target Host)  
Following are the required infrastructure details on which dsa components will be deployed.  
**Baremetal host(stacki backend)** - (Teradata SLES, 2TB HDD, 128 GB RAM,  32 CPU's , 4 network interfaces)

## Monitoring and alerting  
All the logs and system messages which are generated by seedbox automation system will be stored on jenkins server. After running ansible test cases jenkins will generate a test cases execution report.

# FAQ
## DSA Deployment  
**How should I run dsa deployment ansible script?**   
- There are 2 ways to run dsa ansible script.  
  **Using Jenkins** - From jenkins server you just to need run appropriate jenkins job for production or qa environment. (Jenkins job will call ansible script by passing inventory and environment details)    
  **Using CLI** -  Following are the steps which you need to follow using CLI method  
  1. Copy dsa_ansible_installer.tar.gz file on Stacki frontend  
  2. Extract tar file   
  3. Open inventory file and add target box details in inventory file. 
  4. Add vault_pass.txt file and add password of vault in this file.   
  5. run this command: ./run.sh -e ENVIRONMENT -a ACTION  
    Above command will call dsa ansible script by passing environment and actions as cli args.


**Are there any unit test cases in dsa ansible script? How can we execute them?**    
- Yes, every ansible has unit verification test cases. Every ansible role has it's respective test role , which will be executed after component is deployed. No need to execute test cases manuallly.

**How many playbooks are in dsa ansible script? any difference between them?**    
- Dsa ansible script has 2 playbooks.  
  **dsa_setup.yml** - This playbook will deploy kvm and dsa on baremetal devices.  
  This playbook will deploy components in 2 environments i.e prod or qa , depending upon which jenkins job is called. 

  **dsa_setup_on_dbvm.yml** - This playbook will deploy only dsa components on database vm, it will not deploy any kvm packages as target host is not virtualized machine. 
  This playbook is mainly for used in dev environment, where we need dsa setup on database vm.  

**What are the different types of ansible roles in dsa ansible script?**    
- We can broadly classify the ansible roles in following types.  
  **dsa** - These roles will deploy dsc, barcmd, clienthandler etc  
  **kvm** - These roles will deploy kvm related components   
  **disk** - These roles will create partition on seedbox and copies qcow2 to seedbox from apache server  
  **network** - These roles will deploy bynet tool and it will configure bynet interfaces on seedbox.

**Does this script has any verification test cases?**  
- This is verification test cases file. This file has different test cases for verifying the                functionality of viewpoint ui, bynet interfaces and firewall.  
  This file will take 3 cli args as input.   
  example: **bash Seedbox_Verfication_TestCases.sh SEEDBOX_IP BYNET0_IP BYNET1_IP**